##################################
# Serveur de déploiement Jenkins #
##################################
version: '3.8'

services:
    jenkins:
        image: jenkins/docker
        container_name: jenkins
        build:
            context: .
        user: jenkins
        restart: always
        ports:
            -   ${JENKINS_HTTP}           # http_port  le client jenkins
            -   ${JENKINS_AGENT}          # agent_port  master / slave communication

        volumes:
            -  $PWD/jenkins_home:/var/jenkins_home          # Le dossier principale de jenkins
            - /var/run/docker.sock:/var/run/docker.sock     # L'accès socket externe docker

        environment:
            - JENKINS_OPTS="--prefix=/jenkins"
